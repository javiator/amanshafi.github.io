<!-- Mermaid Support -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  window.addEventListener("load", function() {
    console.log("Mermaid script loaded");
    
    mermaid.initialize({ 
      startOnLoad: false,
      theme: "default",
      securityLevel: "loose"
    });
    
    // Process mermaid code blocks
    const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
    console.log("Found mermaid blocks:", mermaidBlocks.length);
    
    mermaidBlocks.forEach(function(block, index) {
      console.log("Processing block", index);
      const parent = block.parentElement;
      const content = block.textContent;
      
      // Create a div for mermaid
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.textContent = content;
      
      // Replace the pre element with the mermaid div
      parent.parentElement.replaceChild(mermaidDiv, parent);
    });
    
    // Initialize mermaid after processing
    setTimeout(function() {
      console.log("Initializing mermaid");
      mermaid.init();
    }, 500);
  });
</script>
