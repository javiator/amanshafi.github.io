<!-- Cloudflare Web Analytics -->
{% if site.analytics.provider == "cloudflare" and site.analytics.cloudflare.token %}
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "{{ site.analytics.cloudflare.token }}"}'></script>
{% endif %}

<!-- Mermaid Support - Only load on pages/posts that need it -->
{% if page.mermaid %}
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    mermaid.initialize({
      startOnLoad: false,
      theme: "default",
      securityLevel: "loose"
    });

    // Process mermaid code blocks
    const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');

    mermaidBlocks.forEach(function(block) {
      const parent = block.parentElement;
      const content = block.textContent;

      // Create a div for mermaid
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.textContent = content;

      // Replace the pre element with the mermaid div
      parent.parentElement.replaceChild(mermaidDiv, parent);
    });

    // Initialize mermaid after processing
    setTimeout(function() {
      mermaid.init();
    }, 100);
  });
</script>
{% endif %}

